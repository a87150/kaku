{% extends 'base.html' %}

{% block main %}

<div class="media">
    <div class="media-left">
        <img class="media-object" src="{{ user.mugshot_thumbnail.url }}" alt=""
             style="width: 73px;"></img>
    </div>
    <div class="media-body">
        <h3 class="media-heading">{{ user.nickname }}</h3>
        <p>{{ user.signature }}</p>
        <div>django forum demo 第 {{ user.pk }} 号会员，加入于 {{ user.date_joined }}</div>
    </div>
</div>
<br></br>
<ul class="article">
    <li class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-content">{{ user.nickname }} 的文章</div>
        <i class="mdui-list-item-icon mdui-icon material-icons">translate</i>
    </li>
    {% for article in article_list %}
    <li class="mdui-list-item mdui-ripple">
        <a class="nav-item" href="{{ article.get_absolute_url }}"> {{ article }} </a>
    </li>
    {% empty %}
    <li class="mdui-list-item mdui-ripple">该用户下面没有</li>
    {% endfor %}
    {% if article_list.count > 9 %}
    <li class="mdui-list-item mdui-ripple"><a href="{% url 'users:articles' user.username %}"
        class="text-muted">{{ user.nickname }}更多文章>></a></li>
    {% endif %}
</ul>

<ul class="picture">
    <li class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-content">{{ user.nickname }} 的图画</div>
        <i class="mdui-list-item-icon mdui-icon material-icons">wallpaper</i>
    </li>
    {% for picture in picture_list %}
    <li class="mdui-list-item mdui-ripple">
        <a href="{{ picture.get_absolute_url }}"> <img src={{ picture.thematic }} class="img-rounded" width="50%" height="50%"/> </a>
    </li>
    {% empty %}
    <li class="mdui-list-item mdui-ripple">该用户下面没有</li>
    {% endfor %}
    {% if article_list.count > 9 %}
    <li class="mdui-list-item mdui-ripple"><a href="{% url 'users:picture' user.username %}"
        class="text-muted">{{ user.nickname }}更多图画>></a></li>
    {% endif %}
</ul>

{% if request.user.is_authenticated %}
<ul class="affairs">
    <li class="mdui-list-item mdui-ripple">
        <div class="mdui-list-item-content">{{ user.nickname }} 的动态</div>
        <i class="mdui-list-item-icon mdui-icon material-icons">motorcycle</i>
    </li>

    {% for act in action_list %}
        <li class="mdui-list-item mdui-ripple">
            {{ act }}
        </li>
    {% empty %}
        <li class="mdui-list-item mdui-ripple">该用户下没有动态</li>
    {% endfor %}
    {% if action_list.count > 19 %}
        <li class="mdui-list-item mdui-ripple"><a href="{% url 'users:actions' user.username %}"
        class="text-muted">{{ user.nickname }}的全部动态>></a></li>
    {% endif %}
</ul>
    {% else %}
    <div class="card card-block">
        需要登录才能查看用户动态
    </div>
    {% endif %}

{% endblock main %}

{% block script %}
    <script>
        function follow(e) {
            var $this = $(this);
            var $ctypeId = $this.attr('data-contenttype-id');
            var $objectId = $this.attr('data-object-id');
            var $url = '/follows/follow_all/' + $ctypeId + '/' + $objectId + '/follow/';
            $.post(
                $url,
                {
                    content_type_id: $ctypeId,
                    object_id: $objectId,
                    ftype: 'follow'
                },
                function (data, status) {
                    $this.find('a').first().html('<i class="fa fa-check" aria-hidden="true"></i> 已关注');
                    var $followNumber = $this.next().first().find('.follow-number').first();
                    $followNumber.text(parseInt($followNumber.text()) + 1);
                    $this.off('click');
                    $this.on('click', unfollow)
                }
            );
            e.preventDefault();
        }

        function unfollow(e) {
            var $this = $(this);
            var $ctypeId = $this.attr('data-contenttype-id');
            var $objectId = $this.attr('data-object-id');
            var $url = '/follows/unfollow_all/' + $ctypeId + '/' + $objectId + '/follow/';
            $.post(
                $url,
                {
                    content_type_id: $ctypeId,
                    object_id: $objectId,
                    ftype: 'follow'
                },
                function (data, status) {
                    $this.find('a').first().html('<i class="fa fa-plus" aria-hidden="true"></i> 关注');
                    var $followNumber = $this.next().first().find('.follow-number').first();
                    $followNumber.text(parseInt($followNumber.text()) - 1);
                    $this.off('click');
                    $this.on('click', follow)
                }
            );
            e.preventDefault();
        }

        $('.follow-btn').on('click', follow);
        $('.unfollow-btn').on('click', unfollow);
    </script>
{% endblock script %}